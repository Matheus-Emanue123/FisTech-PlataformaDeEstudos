generator client {
  provider      = "prisma-client-js"
  output        = "../src/generated/prisma"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Anotacao {
  id           Int       @id @default(autoincrement())
  texto        String    @db.Text
  user_id      Int?
  topico_id    Int?
  data_criacao DateTime? @default(now())
  Usuario      Usuario?  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Anotacao_ibfk_1")
  Topico       Topico?   @relation(fields: [topico_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Anotacao_ibfk_2")

  @@index([topico_id], map: "Anotacao_topico_id")
  @@index([user_id], map: "Anotacao_user_id")
}

model Assunto {
  id        Int      @id @default(autoincrement())
  descricao String?  @db.Text
  nome      String   @db.VarChar(100)
  Topico    Topico[]
}

model Comentario {
  id           Int       @id @default(autoincrement())
  texto        String    @db.Text
  data_criacao DateTime? @default(now())
  removido     Boolean?  @default(false)
  user_id      Int?
  conteudo_id  Int?
  Usuario      Usuario?  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Comentario_ibfk_1")
  Conteudo     Conteudo? @relation(fields: [conteudo_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Comentario_ibfk_2")

  @@index([conteudo_id], map: "Comentario_conteudo_id")
  @@index([user_id], map: "Comentario_user_id")
}

model Conteudo {
  id               Int               @id @default(autoincrement())
  titulo           String            @db.VarChar(255)
  descricao        String?           @db.Text
  url_video        String?           @db.VarChar(255)
  tipo             String?           @db.VarChar(50)
  data_criacao     DateTime?         @default(now())
  topico_id        Int?
  nivel_id         Int?
  criado_por       Int?
  questao_id       Int?
  Comentario       Comentario[]
  Topico           Topico?           @relation(fields: [topico_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Conteudo_ibfk_1")
  NivelDificuldade NivelDificuldade? @relation(fields: [nivel_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Conteudo_ibfk_2")
  Usuario          Usuario?          @relation(fields: [criado_por], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Conteudo_ibfk_3")
  Questao          Questao?          @relation(fields: [questao_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Conteudo_ibfk_4")

  @@index([criado_por], map: "Conteudo_criado_por")
  @@index([nivel_id], map: "Conteudo_nivel_id")
  @@index([questao_id], map: "Conteudo_questao_id")
  @@index([topico_id], map: "Conteudo_topico_id")
}

model MapaMental {
  id           Int       @id @default(autoincrement())
  arquivo_url  String?   @db.VarChar(255)
  data_criacao DateTime? @default(now())
  user_id      Int?
  topico_id    Int?
  Usuario      Usuario?  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "MapaMental_ibfk_1")
  Topico       Topico?   @relation(fields: [topico_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "MapaMental_ibfk_2")

  @@index([topico_id], map: "MapaMental_topico_id")
  @@index([user_id], map: "MapaMental_user_id")
}

model NivelDificuldade {
  id               Int                @id @default(autoincrement())
  xp               Int
  nome             String             @unique @db.VarChar(50)
  Conteudo         Conteudo[]
  Questao          Questao[]
  QuestaoResolvida QuestaoResolvida[]
}

model Questao {
  id               Int                @id @default(autoincrement())
  enunciado        String             @db.Text
  ano              Int?
  origem           String?            @db.VarChar(100)
  fase             String?            @db.VarChar(50)
  alternativas     Json?
  data_criacao     DateTime?          @default(now())
  resolvido        Boolean?
  nivel_id         Int?
  criado_por       Int?
  Conteudo         Conteudo[]
  NivelDificuldade NivelDificuldade?  @relation(fields: [nivel_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Questao_ibfk_1")
  Usuario          Usuario?           @relation(fields: [criado_por], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Questao_ibfk_2")
  QuestaoResolvida QuestaoResolvida[]

  @@index([criado_por], map: "Questao_criado_por")
  @@index([nivel_id], map: "Questao_nivel_id")
}

model QuestaoResolvida {
  id               Int               @id @default(autoincrement())
  data_resolucao   DateTime?         @default(now())
  acerto           Boolean?
  id_user          Int?
  id_questao       Int?
  nivel_id         Int?
  Usuario          Usuario?          @relation(fields: [id_user], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "QuestaoResolvida_ibfk_1")
  Questao          Questao?          @relation(fields: [id_questao], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "QuestaoResolvida_ibfk_2")
  NivelDificuldade NivelDificuldade? @relation(fields: [nivel_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "QuestaoResolvida_ibfk_3")

  @@index([id_questao], map: "QuestaoResolvida_id_questao")
  @@index([id_user], map: "QuestaoResolvida_id_user")
  @@index([nivel_id], map: "QuestaoResolvida_nivel_id")
}

model Resumo {
  id           Int       @id @default(autoincrement())
  texto        String    @db.Text
  data_criacao DateTime? @default(now())
  user_id      Int?
  topico_id    Int?
  Usuario      Usuario?  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Resumo_ibfk_1")
  Topico       Topico?   @relation(fields: [topico_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Resumo_ibfk_2")

  @@index([topico_id], map: "Resumo_topico_id")
  @@index([user_id], map: "Resumo_user_id")
}

model Topico {
  id         Int          @id @default(autoincrement())
  nome       String       @db.VarChar(100)
  descricao  String?      @db.Text
  assunto_id Int?
  Anotacao   Anotacao[]
  Conteudo   Conteudo[]
  MapaMental MapaMental[]
  Resumo     Resumo[]
  Assunto    Assunto?     @relation(fields: [assunto_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Topico_ibfk_1")

  @@index([assunto_id], map: "Topico_assunto_id")
}

model UserType {
  id         Int       @id @default(autoincrement())
  tipo       String    @unique
  permissoes Json
  usuarios   Usuario[]
}

model UserXP {
  user_id       Int       @id
  xp_total      Int
  atualizado_em DateTime? @default(now())
  Usuario       Usuario   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "UserXP_ibfk_1")
}

model Usuario {
  id               Int                @id @default(autoincrement())
  nome             String             @db.VarChar(100)
  email            String             @unique @db.VarChar(100)
  senha_hash       String             @db.VarChar(255)
  data_criacao     DateTime?          @default(now())
  ultimo_login     DateTime?
  disabled         Boolean   @default(false)
  user_type_id     Int
  Anotacao         Anotacao[]
  Comentario       Comentario[]
  Conteudo         Conteudo[]
  MapaMental       MapaMental[]
  Questao          Questao[]
  QuestaoResolvida QuestaoResolvida[]
  Resumo           Resumo[]
  UserXP           UserXP?
  UserType         UserType           @relation(fields: [user_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Usuario_ibfk_1")
  refreshTokens    RefreshToken[]

  @@index([user_type_id], map: "Usuario_user_type_id")
}

model RefreshToken {
  id         Int      @id @default(autoincrement())
  token_hash String   @unique
  usuarioId  Int
  usuario    Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  expiresAt  DateTime
  isRevoked  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

enum UserType_tipo {
  administrador
  moderador
  usuario_padrao
}
